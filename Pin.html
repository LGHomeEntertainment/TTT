<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OTV</title>

  <style>
body {
  font-family: Arial, sans-serif;
  background-color: white;
  color: #333;
  padding: 20px;
}

table {
  border-collapse: collapse; /* removes double borders */
  margin: 20px auto; /* centers the table */
}

td {
  width: 60px;
  height: 60px;
  text-align: center;
  vertical-align: middle;
  font-size: 2rem;
  border: 2px solid #333;
  cursor: pointer;
}

td input {
  width: 100%;
height: 100%;
border: none;
background: transparent;
text-align: center;
padding: 0;
outline: none;
}

input[type="tel"] {
background-color: transparent
border: none
text-align: center;
width: 100%
height: 100%
}

#feedback {
  font-weight: bold;
  margin-top: 20px;
}

button {
  padding: 8px 12px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

button:hover {
  background-color: #45a049;
}

#aiStatus {
  font-style: italic;
  color: #888;
  text-align: center;
  margin-top: 10px;
}

</style>

</head>
<body>

<h1>Open the Vault</h1>


<table>

  <tr data-guess="1">
    <td id="guess1-0"><input type="tel" maxlength="1"></td>
    <td id="guess1-1"><input type="tel" maxlength="1"></td>
    <td id="guess1-2"><input type="tel" maxlength="1"></td>
    <td id="guess1-3"><input type="tel" maxlength="1"></td>
  </tr>

  <tr data-guess="2">
    <td id="guess2-0"><input type="tel" maxlength="1"></td>
    <td id="guess2-1"><input type="tel" maxlength="1"></td>
    <td id="guess2-2"><input type="tel" maxlength="1"></td>
    <td id="guess2-3"><input type="tel" maxlength="1"></td>
  </tr>

  <tr data-guess="3">
    <td id="guess3-0"><input type="tel" maxlength="1"></td>
    <td id="guess3-1"><input type="tel" maxlength="1"></td>
    <td id="guess3-2"><input type="tel" maxlength="1"></td>
    <td id="guess3-3"><input type="tel" maxlength="1"></td>
  </tr>

  <tr data-guess="4">
    <td id="guess4-0"><input type="tel" maxlength="1"></td>
    <td id="guess4-1"><input type="tel" maxlength="1"></td>
    <td id="guess4-2"><input type="tel" maxlength="1"></td>
    <td id="guess4-3"><input type="tel" maxlength="1"></td>
  </tr>

</table>

<div> 
  <p id="feedback"></p>
</div>
<div> 
  <button id="submitBtn">Guess!</button>
</div>
<div> 
  <button id="resetBtn">Start a new game</button>
</div>



<script>

let answerPIN = []; // start empty, then push
let round = 1;
let gameOver = false;



function generatePIN() {
  answerPIN = [];
  for (let i = 0; i < 4; i++) {
    let digit = Math.floor(Math.random() * 10); // inside loop so that it keeps generating new digits to push in
    answerPIN.push(digit);
  }
}

disableAll();
enableCurrentRow();

generatePIN(); // call on it directly to create new pin

document.getElementById("submitBtn").addEventListener("click", checkAnswer);
document.getElementById("submitBtn").addEventListener("keydown", checkAnswer);

document.getElementById("resetBtn").style.display = "none";
document.getElementById("resetBtn").addEventListener("click", resetGame);

function disableAll() {
  let cells = document.querySelectorAll("input[type='tel']");
  cells.forEach((cell)=> {
    cell.disabled = true;
  });
}

function enableCurrentRow() {
  let row = document.querySelector(`tr[data-guess="${round}"]`);
  let rowCells = row.querySelectorAll("input");
  rowCells.forEach((cell, index) => {
    cell.disabled = false;

// auto advance input
cell.addEventListener('input', () => {
if (cell.value.length == 1 && index < 3) {
rowCells[index + 1].focus()
}
})

// backspace
cell.addEventListener("keydown", (e) => {
  if (e.key == "Backspace" && index > 0 && cell.value == "") {
    rowCells[index - 1].focus()
}
})

// enter
cell.addEventListener("keydown", (e) => {
  if (e.key == "Enter" && index == 3 && cell.value.length == 1) {
    checkAnswer()
}
})
})

let firstInput = document.querySelector(`tr[data-guess="${round}"] input[type='tel']`); // calculated every round, so inside the loop
if (firstInput) {
  firstInput.focus()
}
}

function checkAnswer() {
  let currentRow = document.querySelector(`tr[data-guess="${round}"]`);
  let guess = [];
  for (let i = 0; i < 4; i++) {
    let cell = document.getElementById(`guess${round}-${i}`);
    let cellValue = cell.querySelector("input");

    if (cellValue.value == "") {
      document.getElementById("feedback").textContent = "Please key in 4 digits";
      return;
    } else {
      guess.push(parseInt(cellValue.value));
    }
  }
  for (let i = 0; i < 4; i++) {
    let cell = document.getElementById(`guess${round}-${i}`);
    if (guess[i] == answerPIN[i]) {
      // change bg color
      cell.style.backgroundColor = "green";
    } else if (answerPIN.includes(guess[i])) {
      // diff colours
      cell.style.backgroundColor = "yellow";
    } else {
      cell.style.backgroundColor = "gray";
    }
  }
  disableAll()
  if (guess[0] == answerPIN[0] && guess[1] == answerPIN[1] && guess[2] == answerPIN[2] && guess[3] == answerPIN[3]) {
    gameOver = true;  
    document.getElementById("resetBtn").style.display = "inline-block";
    document.getElementById("submitBtn").style.display = "none";
  } else if (round < 4) {
    round++;
  enableCurrentRow();
  } else {
    gameOver = true;
    document.getElementById("resetBtn").style.display = "inline-block";
    document.getElementById("submitBtn").style.display = "none";
  }
}

function resetGame() {
  document.getElementById("resetBtn").style.display = "none";
  document.getElementById("feedback").textContent = "";
  // clear cell contents too!!!
  let cells = document.querySelectorAll("input[type='tel']");
     cells.forEach((cell) => {
    cell.value = "";
  });
  let cellColor = document.querySelectorAll("td");
cellColor.forEach((x) => {
x.style.backgroundColor = "transparent"; //reset colour too!!!
})
  generatePIN();
  round = 1;
  gameOver = false;
  enableCurrentRow();
  document.getElementById("submitBtn").style.display = "block";
}

</script>

</body>
</html>

