<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>SDK</title>

    <style>

body {
  font-family: Arial, sans-serif;
  text-align: center;
  margin-top: 20px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(9, 40px);
  grid-template-rows: repeat(9, 40px);
  gap: 2px;
  width: fit-content;
  margin: 20px auto;
}

.cell {
width: 40px;
height: 40px;
background: #fff;
border: 1px solid #999;
display: flex;
align-items: center;
justify-content: center;
font-size: 20px;
cursor: pointer;
user-select: none;
}

.cell.error {
color: red;
}

/* thicker box borders */
.cell:nth-child(3n):not(:nth-child(9n)) {
border-right: 2px solid #000;
}

.cell:nth-child(n + 19):nth-child(-n + 27),
.cell:nth-child(n + 46):nth-child(-n + 54) {
border-bottom: 2px solid #000;
}

#number-pad {
display: grid;
grid-template-columns: repeat(5, 50px);
gap: 8px;
justify-content: center;
margin-top: 20px;
}

#number-pad button {
height: 50px;
font-size: 20px;
border-radius: 8px;
border: 1px solid #555;
background: #eee;
}

#number-pad button:active {
background: #ccc;
}

.cell.selected {
background: #cce4ff;
}

.cell.fixed {
background: #ddd;
font-weight: bold;
cursor: default;
}


    </style>

  </head>
  <body>
    
 <h1>SP</h1>
  <div id="sudoku-board" class="grid"></div>

<div id="number-pad"> 
<button>1</button>
<button>2</button>
<button>3</button>
<button>4</button>
<button>5</button>
<button>6</button>
<button>7</button>
<button>8</button>
<button>9</button>
<button data-clear="true">X</button>
</div>
    
    <div>
      <p id="feedback"></p>
    </div>

    <div>
      <button id="resetBtn">Start over</button>
      <button id="fullResetBtn">Start a new game</button>
    </div>


<script>

let selectedCell = null
let playerBoard = [] // what player inputs
let puzzleBoard = [] // initial grid
let solvedBoard = [] // solution


document.addEventListener("DOMContentLoaded", initialise);

function initialise() {
//  document.getElementById("grid").innerHTML = "";
solvedBoard = generateSolvedSudoku()
puzzleBoard = makePuzzle(solvedBoard, 40)
playerBoard = puzzleBoard.map(row => [...row])
renderBoard(puzzleBoard, playerBoard)
  attachListeners();
}

// 1. Generate a solved Sudoku board
function generateSolvedSudoku() {
  const board = Array.from({ length: 9 }, () => Array(9).fill(0));

  function isValid(board, row, col, num) {
    for (let i = 0; i < 9; i++) {
      if (board[row][i] === num || board[i][col] === num) return false;
    }
    const boxRow = Math.floor(row / 3) * 3;
    const boxCol = Math.floor(col / 3) * 3;

    for (let r = 0; r < 3; r++) {
      for (let c = 0; c < 3; c++) {
        if (board[boxRow + r][boxCol + c] === num) return false;
      }
    }
    return true;
  }

  function fillBoard(board) {
    for (let row = 0; row < 9; row++) {
      for (let col = 0; col < 9; col++) {
        if (board[row][col] === 0) {
          const nums = [1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5);

          for (let num of nums) {
            if (isValid(board, row, col, num)) {
              board[row][col] = num;
              if (fillBoard(board)) return true;
              board[row][col] = 0;
            }
          }
          return false;
        }
      }
    }
    return true;
  }

  fillBoard(board);
  return board;
}

// 2. Remove numbers to create a puzzle
function makePuzzle(board, blanks = 40) {
  const puzzle = board.map(row => [...row]);
  let removed = 0;
  while (removed < blanks) {
    const r = Math.floor(Math.random() * 9);
    const c = Math.floor(Math.random() * 9);
    if (puzzle[r][c] !== 0) {
      puzzle[r][c] = 0;
      removed++;
    }
  }
return puzzle;
}


// 3. Render the board in HTML

function renderBoard(puzzleBoard, playerBoard) {

  const container = document.getElementById("sudoku-board");
  container.innerHTML = "";

  puzzleBoard.forEach((row, r) => {
    row.forEach((cell, c) => {
      const div = document.createElement("div");
      div.className = "cell";

div.dataset.row = r
div.dataset.col = c

if (cell != 0) { 
div.textContent = cell
div.classList.add("fixed")
} else {
let value = playerBoard[r][c]
div.textContent = value == 0 ? "" : value
}

      // âœ… Attach click listener
      div.addEventListener("click", () => {
if (div.classList.contains("fixed")) return;
document.querySelectorAll(".cell").forEach(c => c.classList.remove("selected"))
div.classList.add("selected")
selectedCell = div
      });

      container.appendChild(div);
    });
  });
}

// 4. Run everything
// const solved = generateSolvedSudoku();
// let puzzleBoard = makePuzzle(solvedBoard, 40)
// playerBoard = puzzleBoard.map(row => [...row]);
// renderBoard(puzzle);
// console.table(puzzle);

function attachListeners() {
document.querySelectorAll("#number-pad button").forEach(btn => { 
btn.addEventListener("click", () => {
if (!selectedCell) return

let r = Number(selectedCell.dataset.row)
let c = Number(selectedCell.dataset.col)

if (btn.dataset.clear) { 
playerBoard[r][c] = 0
selectedCell.textContent = ""
return 
}

let num = Number(btn.textContent)
playerBoard[r][c] = num;
selectedCell.textContent = num
checkCell(r, c)
})
})
  
document.getElementById("resetBtn").addEventListener("click", () => {
    resetRound();
  });
document.getElementById("fullResetBtn").addEventListener("click", () => {
    newGame();
})}

function checkCell(r, c) {
if (playerBoard[r][c] != solvedBoard[r][c]) {
 selectedCell.classList.add("error")
} else if (playerBoard[r][c] == solvedBoard[r][c]) {
selectedCell.classList.remove("error")
}
checkWin()
}

function checkWin() {
for (let r = 0; r < 9; r++) {
for (let c = 0; c < 9; c++) {

// still empty
if (playerBoard[r][c] == 0) return

// still have error
if (playerBoard[r][c] != solvedBoard[r][c]) return
}}
document.getElementById("feedback").textContent = "You win!"
}


function resetRound() {
playerBoard = puzzleBoard.map(row => [...row])
return
}

function newGame() {
initialise()
}

</script>

</body>
</html>
